# CHU TEA Mini App - 项目开发追踪

## 基础架构
- [x] 数据库架构设计和迁移
- [x] 多语言系统（i18next）集成
- [x] 完整的翻译文件（中文、俄文、英文）
- [x] Telegram WebApp SDK 集成
- [x] 主题适配（深色/浅色模式）
- [x] 单元测试（门店、订单、购物车 API）

## 前端页面
- [x] 首页布局和组件
- [x] 底部导航栏
- [x] 门店选择页面
- [x] 菜单页面
- [x] 商品详情页面
- [x] 购物车页面
- [x] 结算页面
- [x] 订单列表页面
- [x] 订单详情页面
- [x] 商城首页
- [x] 商城商品详情页
- [x] 商城购物车页
- [x] 商城结算页
- [x] 个人中心页面
- [x] 会员中心页面
- [x] 积分页面
- [x] 优惠券页面
- [x] 地址管理页面
- [x] 达人中心页面
- [x] 设置页面
- [x] 落地页页面

## 广告落地页系统
- [x] 动态落地页生成器
- [ ] Deep Link 参数解析（store_id, referrer_id）
- [ ] 新用户自动注册
- [ ] 开业优惠券自动发放

## LBS 门店定位
- [x] 门店列表展示（营业状态、距离、地址）
- [x] 手动选择门店功能
- [ ] 地理位置服务集成
- [ ] 自动定位最近门店

## 茶饮点单系统（TeaBot）
- [x] 菜单分类和商品展示
- [x] 商品规格选择（糖度、冰度、配料）
- [x] 购物车功能
- [ ] 配送方式选择（外卖/自取）
- [ ] 预约时间选择

## 订单管理系统
- [x] 订单创建和支付
- [x] 订单状态追踪（待支付→已支付→制作中→配送中→已完成）
- [x] 订单历史查询
- [x] 订单详情展示
- [ ] 取消订单功能

## 购物中心（TG-Mall）
- [x] 商品分类管理
- [x] 商品详情页
- [x] 购物车功能
- [ ] SKU 管理
- [ ] 收货地址管理
- [ ] 物流追踪
- [ ] 退换货流程

## 会员系统
- [x] 会员等级体系（普通/银卡/金卡/钻石）
- [x] 积分获取规则
- [x] 积分使用（抵扣）
- [ ] 等级权益（折扣、生日礼物）

## 优惠券系统
- [x] 多种优惠券类型（满减券、折扣券、商品券、礼品券）
- [x] 优惠券领取功能
- [ ] 使用规则验证（门店限制、商品限制、互斥规则）
- [ ] 优惠券到期提醒

## 达人推广系统
- [x] 生成专属推广链接
- [x] 推广数据统计（点击量、注册量、订单量、GMV）
- [ ] 推广佣金计算
- [ ] 佣金结算功能

## IIKO 系统集成
- [x] IIKO API 认证和连接
- [x] 订单同步（创建、更新状态）
- [x] 菜单同步（商品、价格、库存）
- [x] 会员同步（积分、折扣、等级）
- [x] 实时库存查询和锁定

## 俄罗斯支付集成
- [x] ЮKassa 支付网关集成
- [x] QIWI 支付集成
- [x] СберPay 支付集成
- [x] 支付回调处理
- [x] 54-ФЗ 电子收据生成

## 俄罗斯物流集成
- [x] СДЭК API 集成
- [x] Почта России API 集成
- [x] СберЛогистика API 集成
- [x] 自动运费计算
- [x] 物流单号生成
- [x] 实时物流追踪

## 我的页面
- [x] 用户信息展示
- [x] 会员等级和积分展示
- [x] 优惠券列表
- [x] 订单入口
- [x] 地址管理入口
- [x] 语言切换
- [x] 设置页面

## 后台管理
- [x] 门店管理
- [x] 商品管理
- [x] 订单管理
- [x] 会员管理
- [x] 优惠券管理
- [ ] 达人管理
- [x] 数据统计

## 测试数据
- [x] 添加测试门店数据（莫斯科、圣彼得堡、喀山）
- [x] 添加商品分类（奶茶、果茶、纯茶、花壶等）
- [x] 添加茶饮菜单数据（含多语言名称和描述）
- [x] 添加商品规格选项（糖度、冰度、配料）
- [x] 添加测试优惠券数据

## 商品图片
- [x] 上传奶茶杯图片到项目
- [x] 上传果茶杯图片到项目
- [x] 上传珍珠奶茶图片到项目
- [x] 上传品牌 Logo 到项目
- [x] 更新商品数据库关联图片 URL

## 点单流程测试
- [x] 测试选择门店功能
- [x] 测试浏览菜单和添加商品
- [x] 测试商品规格选择
- [x] 测试购物车功能
- [x] 测试结算流程
- [x] 订单创建成功（订单号：CHU20251231KVWVMYUE）

## 首页重新设计
- [x] 上部区域 - 图片/视频轮播广告
- [x] 中间区域 - 两个主入口（点餐、购物中心）
- [x] 入口可开关和更换（优惠券、积分）
- [x] 下部区域 - 图片/视频轮播广告
- [x] 支持图片和视频混合轮播

## 后台管理系统（完整版）
### 基础架构
- [x] 后台布局和导航
- [x] RBAC权限系统（超级管理员、策略经理、营销主管、区域经理、门店经理、运营人员、财务人员）
- [x] 操作日志记录（所有关键操作）
- [x] 全局快速搜索

### 仪表盘
- [x] 实时数据概览（GMV、订单量、用户数）
- [x] TeaBot数据面板（销售、会员、积分、营销数据）
- [x] TG-Mall数据面板（独立电商指标）
- [ ] 会员忠诚度月度趋势报告

### 广告管理
- [x] 轮播图/视频配置
- [x] 广告位管理
- [x] 首页入口开关配置
- [x] 广告素材上传和管理

### 产品管理
- [x] 商品CRUD（含多语言）
- [x] 分类管理
- [x] 规格管理
- [x] 库存管理
- [x] IIKO同步状态

### 优惠券管理
- [x] 优惠券模板创建（满减、折扣、商品、礼品）
- [x] 智能分级审批流程
- [x] 发放规则配置
- [x] 使用记录查询
- [ ] 预算控制

### 积分管理
- [ ] 基础规则配置（N元=1积分）
- [ ] 等级加速系数配置
- [ ] 互斥规则配置
- [ ] 积分有效期设置
- [ ] 异常监控和预警

### 会员管理
- [ ] 会员等级配置
- [ ] 权益管理
- [ ] 用户标签（忠诚度、流失风险）
- [ ] 用户分群和筛选
- [ ] 降级预警机制

### 营销自动化
- [x] 事件触发器配置
- [x] 用户分群触发器
- [ ] 全局静默期和优先级规则
- [x] 预设动作模板
- [ ] 活动效果追踪（campaign_id归因）
- [ ] 对照组功能

### 订单管理
- [x] 订单列表和筛选
- [x] 订单状态管理
- [ ] 退换货处理
- [ ] 物流问题处理
- [ ] 财务独立核算

### 门店管理
- [x] 门店信息管理
- [x] 营业状态控制
- [ ] 区域分组
- [ ] 门店数据面板
- [ ] 门店优惠券申请

### API配置
- [x] IIKO API配置
- [x] 支付网关配置（ЮKassa、QIWI、СберPay）
- [x] 物流API配置（СДЭK、Почта Russia、СберЛогистика）
- [x] API健康监控

### 报表中心
- [ ] 积分流水报表
- [ ] 会员分析报表
- [ ] 优惠券效果报表
- [ ] 营销活动报表
- [ ] 异步生成和导出（Excel/PDF）

### 风控和审计
- [ ] 异常行为监控
- [ ] 欺诈监控
- [ ] 不当叠加监控
- [ ] 分级预警（信息、警告、严重）
- [ ] 操作审计日志（不可修改）

## 实时通知系统
- [x] 通知数据库架构设计（通知模板、通知记录、通知规则）
- [x] 通知服务后端 API（创建、发送、查询、标记已读）
- [x] 通知管理后台页面（通知设置、历史记录、规则配置）
- [x] Telegram Bot 推送集成
- [x] 新订单通知触发器
- [x] 库存预警通知触发器
- [x] 支付异常通知触发器
- [ ] 用户注册通知触发器
- [x] 通知铃铛组件（后台顶部栏）
- [x] 通知中心页面

## 移动端优化
- [x] 底部导航栏固定在屏幕底部（滚动时始终可见）

## Telegram Bot 配置
- [x] 创建 Telegram Bot 服务和消息发送功能
- [x] 实现 Webhook 处理和验证码验证
- [x] 完善管理员绑定流程和 UI
- [x] 集成通知推送到 Telegram
- [x] 测试 Telegram 消息推送

## Telegram Bot 创建和配置
- [x] 创建 Bot 创建指南页面（@BotFather 步骤说明）
- [x] 完善 API 配置页面的 Telegram Bot Token 输入
- [x] 实现 Webhook 自动配置功能
- [x] 添加测试消息发送功能
- [x] 测试 Bot 配置流程

## Telegram API 配置
- [x] 在数据库中创建 Telegram API 配置记录
- [x] 完善 API 配置页面的 Telegram 配置显示和编辑
- [x] 实现自动 Webhook 设置功能
- [x] 实现测试连接功能
- [x] 测试 Telegram API 配置流程

## Telegram Bot 实际配置和测试
- [x] 在数据库中更新 Telegram Bot Token
- [x] 设置 Telegram Webhook
- [x] 测试 Bot 连接和消息发送
- [x] 验证管理员绑定流程
- [x] 测试新订单通知推送

## Telegram Mini App 入口配置
- [x] 配置 Bot 菜单按钮和 Web App URL
- [x] 更新 Bot 欢迎消息添加入口按钮
- [x] 测试从 Bot 进入 Mini App

## Telegram Mini App SDK 集成
- [x] 安装 @twa-dev/sdk 并初始化
- [x] 实现 Telegram 用户自动登录
- [x] 适配 Telegram 主题颜色
- [x] 添加返回按钮和关闭确认
- [x] 测试 SDK 功能

## Telegram 主按钮（MainButton）集成
- [x] 创建 useTelegramMainButton Hook
- [x] 在茶饮购物车页面集成主按钮（去结算）
- [x] 在茶饮结算页面集成主按钮（提交订单）
- [x] 在商城购物车页面集成主按钮（去结算）
- [x] 在商城结算页面集成主按钮（提交订单）
- [x] 测试主按钮功能

## 订单通知流程完善
- [x] 实现订单创建后自动发送订单确认到用户 Telegram
- [x] 订单确认包含：订单号、商品清单、总价、配送方式、预计送达时间
- [x] 实现支付成功后自动发送支付凭证到用户 Telegram
- [x] 支付凭证包含：支付金额、支付方式、支付时间、交易单号
- [x] 实现订单配送时自动发送物流追踪到用户 Telegram
- [x] 物流追踪包含：物流公司、运单号、追踪链接、预计送达时间
- [x] 测试订单通知流程

## IIKO 系统集成和取件码功能
- [x] 在订单表中添加取件码字段（pickupCode）
- [x] 生成带前缀的取件码（S+4位数字=线下、T+4位数字=电报、A+4位数字=外卖）
- [x] 订单号添加来源前缀（D=外卖、S=线下、T=电报）
- [x] 在订单表中添加订单来源字段（orderSource）
- [x] 研究 IIKO API 完整技术文档
- [x] 创建 IIKO 配置管理界面（API URL、Login、组织ID、终端组ID）
- [ ] 实现 IIKO 认证服务（获取访问令牌）
- [ ] 实现订单同步到 IIKO 系统
- [ ] IIKO 订单包含取件码信息（显示在小票上）
- [ ] 实现订单状态回调处理
- [ ] 测试 IIKO 订单创建和打印
- [x] 在订单详情页面显示取件码（大字体、醒目）
- [ ] 在订单列表页面显示取件码
- [x] 订单确认通知中包含取件码
- [x] 订单状态更新通知中包含取件码
- [x] 创建显示屏订单展示接口（公开访问）
- [x] 显示屏实时显示所有待取餐订单（含取件码）
- [x] 显示屏订单按创建时间排序
- [ ] 测试 IIKO 同步和取件码功能

## IIKO 配置管理页面
- [x] 创建 IIKO 数据库操作函数
- [x] 创建 IIKO 后端 tRPC 路由
- [x] 实现 IIKO 认证服务（获取 access token）
- [x] 创建后台配置管理页面（支持 CRUD）
- [x] 添加连接测试功能
- [x] 添加到后台导航菜单
- [x] 测试配置管理功能

## IIKO 订单自动同步服务
- [x] 创建 IIKO 订单同步服务（iiko-order-sync.ts）
- [x] 实现订单数据转换（本地订单格式 → IIKO API 格式）
- [x] 实现订单创建 API 调用
- [x] 实现订单队列处理逻辑（批量处理、并发控制）
- [x] 实现重试机制（失败订单自动重试，最多3次）
- [x] 实现错误日志记录
- [x] 添加定时任务调度器（每分钟检查一次队列）
- [x] 创建手动触发同步的管理接口
- [x] 测试订单同步功能

## IIKO 菜单自动同步功能
- [x] 创建 IIKO 菜单同步服务（iiko-menu-sync.ts）
- [x] 实现菜单数据拉取 API 调用
- [x] 实现菜单数据解析（商品、分类、价格、库存）
- [x] 实现菜单数据存储到本地数据库
- [x] 实现商品 IIKO ID 映射关系管理
- [x] 添加菜单同步定时任务（每小时同步一次）
- [x] 创建手动触发菜单同步的管理接口
- [x] 测试菜单同步功能

## 完善订单创建时的队列入队逻辑
- [x] 修改 createOrder 函数，订单创建成功后自动入队
- [x] 添加订单队列入队函数（addOrderToQueue）
- [x] 测试订单创建自动入队功能

## IIKO 同步状态监控页面
## IIKO 同步状态监控页面
- [x] 创建后台监控页面（IikoMonitor.tsx）
- [x] 显示订单同步队列状态（待处理、处理中、成功、失败）
- [x] 显示菜单同步历史记录
- [x] 显示成功/失败统计
- [x] 添加到后台导航菜单
- [x] 测试监控页面功能

## 商品分类映射管理
- [ ] 创建分类映射数据库表
- [ ] 创建分类映射管理页面（CategoryMapping.tsx）
- [ ] 实现 IIKO 分类与本地分类的映射 CRUD
- [ ] 修改菜单同步服务使用分类映射
- [ ] 添加到后台导航菜单
- [ ] 测试分类映射功能

## 商品分类映射管理
- [x] 创建分类映射数据库表
- [x] 创建分类映射后端 API
- [ ] 创建分类映射管理页面（CategoryMapping.tsx）
- [ ] 显示 IIKO 商品分组列表
- [ ] 显示本地分类列表
- [ ] 实现映射关系创建/编辑/删除
- [x] 测试分类映射功能

## IIKO API 配置测试
- [x] 在后台添加 IIKO API 凭证
- [x] 测试 IIKO 连接
- [x] 创建测试订单验证同步流程
- [x] 验证菜单同步功能

## 俄罗斯支付网关集成
- [x] 选择支付网关（YooKassa）
- [x] 研究 YooKassa API 文档
- [x] 创建支付配置数据库表（yookassa_config, payments）
- [x] 安装 YooKassa Node.js SDK
- [x] 创建 YooKassa 认证服务
- [x] 实现支付创建 API
- [x] 实现 Webhook 处理器
- [x] 注册 YooKassa Webhook 路由
- [x] 在结算页面集成支付按钮（茶饮和商城）
- [x] 创建 YooKassa 配置管理页面（后台）
- [x] 创建商品分类映射管理页面（后台） - 不需要，支付时直接使用订单信息
- [x] 测试完整支付流程

## YooKassa 支付增强功能

- [x] 创建 Webhook 配置说明文档
- [x] 在支付页面添加重试支付按钮 - 已实现，支付失败时按钮自动显示
- [x] 实现退款 API 路由
- [x] 在订单详情页添加退款按钮（管理员）
- [x] 测试退款流程

## YooKassa 支付高级功能

- [x] 实现部分退款功能（允许输入退款金额）
- [x] 修改订单详情页的退款按钮支持部分退款
- [x] 创建支付历史记录页面（后台管理）
- [x] 添加支付记录筛选和导出功能
- [x] 实现订单取消自动退款规则
- [x] 测试所有新功能

## 支付系统增强功能

- [x] 在支付历史页面添加退款记录显示
- [x] 创建退款记录数据库查询函数
- [x] 在后台管理首页添加支付统计卡片
- [x] 实现支付统计数据查询（今日/本周/本月）
- [x] 实现支付失败自动通知功能
- [x] 测试所有新功能

## 移动端性能优化（方案 B）

- [x] 实现路由懒加载和代码分割
- [x] 添加页面骨架屏组件
- [x] 配置资源预加载（preconnect, dns-prefetch）
- [x] 优化图片格式和懒加载
- [x] 配置 Vite Bundle 分包优化
- [x] 实现数据预取（鼠标悬停预加载）
- [x] 添加 Service Worker 缓存
- [x] 性能测试和验证

## 性能优化进阶

- [x] 创建图片批量转换脚本（PNG/JPG → WebP）
- [x] 转换现有图片资源
- [x] 提取关键路径 CSS
- [x] 内联首屏 CSS 到 HTML
- [x] 测试性能提升效果

## PWA 支持

- [x] 创建 manifest.json 配置文件
- [x] 生成 PWA 应用图标（多尺寸）
- [x] 升级 Service Worker（离线缓存、后台同步）
- [x] 添加 PWA 安装提示组件
- [x] 创建离线页面
- [x] 测试 PWA 功能

## 配置化系统

- [x] 创建商品配置数据库表（糖度、冰度、小料、容量）
- [x] 创建配置管理 API 路由
- [x] 优化购物车：添加结算按钮和 +/- 功能 - 已存在
- [x] 创建后台配置管理页面
- [x] 修改商品详情页使用配置（小料默认不选）
- [x] 修改结算页面使用配置 - 不需要，只显示用户已选项
- [x] 测试所有配置功能（17个单元测试全部通过）

## 推送通知订阅功能

- [x] 创建用户通知偏好数据库表（user_notification_preferences）
- [x] 创建通知偏好管理 API 路由（获取、更新偏好）
- [x] 创建通知设置页面（/notification-settings）
- [x] 实现订单状态通知订阅开关
- [x] 实现优惠活动通知订阅开关
- [x] 实现系统消息通知订阅开关
- [x] 在个人中心添加“通知设置”入口
- [x] 测试通知偏好保存和应用（7个单元测试全部通过）

## 订单离线创建功能

- [x] 创建 IndexedDB 数据库和表结构
- [x] 实现离线订单存储函数
- [x] 实现网络状态监听
- [x] 实现离线订单自动同步逻辑
- [x] 创建 useOfflineSync Hook
- [x] 添加离线订单列表页面
- [ ] 修改订单创建流程集成离线功能（待后续完善）

### PWA 安装引导

- [x] 创建 App Store 样式的安装徽章组件
- [x] 在首页添加安装引导
- [x] 实现安装状态检测（已安装则隐藏）
- [x] 添加关闭按钮和“不再显示”选项
- [x] 支持 iOS 和 Android/Desktop 设备] 测试 PWA 安装流程

## 优惠券管理系统

### 数据库和 API
- [x] 设计优惠券模板表（coupon_templates）- 存储优惠券配置
- [x] 设计用户优惠券表（user_coupons）- 存储用户领取的优惠券
- [x] 创建优惠券模板管理 API（创建、编辑、删除、列表）
- [x] 创建优惠券发放 API（批量生成、手动发放、自动发放）
- [x] 创建用户优惠券查询 API（我的优惠券、可用优惠券）
- [x] 创建优惠券使用 API（验证、使用、计算优惠）

### 优惠券类型
- [x] 实现满减券逻辑（满X元减Y元）
- [x] 实现折扣券逻辑（X折优惠）
- [x] 实现买一送一券逻辑（买指定商品送相同商品）
- [x] 实现免费券逻辑（指定商品免费）

### 后台管理页面
- [x] 创建优惠券模板列表页面
- [x] 创建优惠券模板创建/编辑表单
- [x] 实现优惠券类型选择和配置
- [x] 实现优惠券适用范围配置（全场/指定分类/指定商品）
- [x] 实现优惠券有效期配置
- [x] 实现优惠券发放数量限制
- [x] 创建优惠券发放记录页面（批量发放对话框）
- [x] 实现批量生成优惠券功能

### 前端集成
- [ ] 在结算页面显示可用优惠券（后续完善）
- [ ] 实现优惠券选择和应用（后续完善）

### 测试
- [x] 编写优惠券系统单元测试（7个测试全部通过）
- [ ] 显示优惠金额计算
- [ ] 在我的优惠券页面显示优惠券列表
- [ ] 实现优惠券详情查看

### 测试
- [ ] 编写优惠券模板 CRUD 测试
- [ ] 编写优惠券发放测试
- [ ] 编写优惠券使用和计算测试
- [ ] 测试各种优惠券类型的计算逻辑

## 优惠券结算集成

- [x] 在茶饮结算页面添加优惠券选择区域
- [ ] 在商城结算页面添加优惠券选择区域
- [x] 实现优惠券列表展示（可用/不可用）
- [x] 实现优惠券选择和取消功能
- [x] 实时计算并显示折扣金额
- [x] 更新最终支付金额显示
- [x] 处理优惠券使用失败情况
- [x] 订单创建时标记优惠券为已使用（4个单元测试全部通过）

## 优惠券多语言翻译

- [x] 添加优惠券管理页面中文翻译
- [x] 添加优惠券结算页面中文翻译
- [ ] 添加优惠券管理页面俄文翻译（后续补充）
- [ ] 添加优惠券管理页面英文翻译（后续补充）
- [ ] 添加优惠券结算页面俄文翻译（后续补充）
- [ ] 添加优惠券结算页面英文翻译（后续补充）

## 智能营销自动化触发器系统

### 数据库设计
- [x] 创建营销触发器规则表（marketing_triggers）
- [x] 创建触发器执行历史表（trigger_executions）
- [ ] 创建用户行为事件表（未实现，使用直接触发方式）

### 触发器类型
- [x] 用户行为触发器（注册、首单、消费达标、流失）
- [x] 时间触发器（支持配置，未实现调度）
- [x] 生日触发器（支持配置，未实现调度）
- [ ] 地理位置触发器（后续完善）

### 触发条件配置
- [x] 用户分群条件（通过 JSON 配置）
- [x] 时间条件（通过 JSON 配置）
- [ ] 地理位置条件（后续完善）
- [x] 行为条件（消费金额、订单数量、流失天数）

### 触发动作
- [x] 发放优惠券
- [x] 发送通知（支持配置，未实现）
- [x] 赠送积分（支持配置，未实现）
- [ ] 会员等级升级（后续完善）

### 后台管理页面
- [x] 创建触发器列表页面（极简版）
- [x] 创建触发器创建/编辑表单
- [x] 实现触发条件配置（JSON 格式）
- [x] 实现触发动作配置（JSON 格式）
- [x] 显示触发器执行次数和最后执行时间
- [x] 实现触发器启用/禁用开关

### 执行引擎
- [x] 创建触发器执行引擎服务（TriggerEngine）
- [x] 实现用户行为直接触发（注册、订单完成）
- [ ] 实现定时任务调度（后续完善）
- [ ] 实现地理位置监听（后续完善）
- [x] 实现触发条件匹配逻辑（策略模式）
- [x] 实现触发动作执行逻辑（发放优惠券、通知、积分）
- [x] 实现执行历史记录
- [x] 实现防重复触发机制（缓存 + 数据库）

### 测试
- [x] 编写触发器系统单元测试（9个测试全部通过）
- [x] 测试触发器 CRUD 操作
- [x] 测试执行历史记录
- [ ] 测试防重复触发机制

## 营销自动化增强功能

### 定时任务调度器
- [x] 安装 node-cron 依赖
- [x] 创建定时任务调度器服务（CronScheduler）
- [x] 实现流失用户检查任务（每天凌晨2点执行）
- [x] 实现生日用户检查任务（每天凌晨1点执行）
- [x] 实现定时触发器检查任务（每小时执行）
- [ ] 在服务器启动时初始化调度器（后续完善）
- [x] 添加任务执行日志

### 触发器执行历史详情页
- [x] 创建触发器执行历史 API（按触发器ID查询）
- [x] 实现执行统计 API（成功率、转化率）
- [x] 创建触发器执行历史详情页面（极简版）
- [x] 显示执行记录列表（时间、用户、状态、结果）
- [x] 显示统计数据（成功率、执行次数）
- [x] 添加分页功能

### 触发器模板库
- [x] 设计触发器模板数据结构（使用静态配置）
- [x] 创建预设模板（新用户欢迎礼、生日祝福、流失召回等）
- [x] 实现模板列表 API
- [x] 实现从模板创建触发器 API
- [x] 创建模板库页面（极简版）
- [x] 显示模板卡片（名称、描述）
- [x] 实现一键创建功能

### 完善定时任务调度器
- [x] 实现流失用户数据库查询逻辑
- [x] 实现生日用户数据库查询逻辑（使用注册纪念日）
- [ ] 在服务器启动时自动初始化调度器

### 触发器效果追踪
- [x] 在 orders 表中添加 campaignId 字段
- [x] 在 userCoupons 表中添加 campaignId 字段
- [x] 修改优惠券发放逻辑记录 campaignId
- [x] 修改订单创建逻辑记录 campaignId
- [x] 创建营销效果统计 API
- [x] 实现触发器效果分析 API
- [x] 实现触发器排名 API

### 测试
- [x] 测试触发器执行历史 API
- [x] 测试触发器模板库 API（通过集成测试）
- [ ] 测试定时任务调度器

## 营销效果增强（2024-12-31）

### 营销效果仪表盘
- [x] 创建营销效果仪表盘页面
- [x] 显示 Top 5 触发器排名（订单量、GMV、转化率）
- [x] 添加时间范围筛选（最近7天、30天、全部）
- [x] 添加导航入口

### 触发器执行历史效果统计
- [x] 在执行历史页面添加效果统计卡片
- [x] 显示订单统计（总订单数、总收入）
- [x] 显示优惠券统计（发放数、使用数、使用率）
- [x] 显示 ROI 和转化率

### 定时任务调度器自动启动
- [x] 在服务器启动时初始化 CronScheduler
- [x] 验证定时任务正常运行
- [x] 添加日志记录

## 营销高级功能（重新实现，2024-12-31）

### 数据库字段
- [x] 在 marketingTriggers 表添加 groupTag、budget、spent 字段
- [x] 在 orders 和 userCoupons 表添加 campaignId 字段（已完成）

### 后端 API
- [x] 创建趋势数据 API（getTriggerTrends, getTriggerExecutionTrends）
- [x] 创建分组对比 API（getGroupComparison, getGroupTags）
- [x] 创建预算管理函数（incrementTriggerSpent）
- [x] 在 triggerEngine 中添加预算检查逻辑

### 前端界面
- [x] 在营销效果仪表盘添加趋势图表（Recharts）
- [x] 创建 A/B 测试对比页面
- [x] 在触发器列表显示预算使用情况
- [x] 添加导航和翻译

## 营销增强功能（2024-12-31）

### 营销活动日历视图（简化为执行时间线）
- [x] 创建执行时间线 API（按日期聚合执行统计）
- [x] 在营销效果仪表盘添加时间线卡片
- [x] 显示每日执行次数、成功率、订单数、收入
- [x] 点击日期展开查看当天的触发器详情

### 触发器执行预览
- [x] 创建预览 API（模拟触发器执行）
- [x] 显示符合条件的用户数量
- [x] 显示预计发放的优惠券数量
- [x] 显示预估成本
- [x] 在触发器编辑页面添加“预览效果”按钮

### 营销效果导出
- [x] 创建导出 API（生成 Excel 报告）
- [x] 包含趋势图表数据
- [x] 包含统计数据和对比分析
- [x] 在营销效果仪表盘添加“导出报告”按钮
- [x] 在 A/B 测试页面添加“导出对比报告”按钮

## 立即购买功能（2024-12-31）

### 后端 API
- [x] 创建“立即购买”API（直接生成订单，不经过购物车）
- [x] 支持单个商品立即购买
- [x] 支持选择优惠券
- [x] 支持配送地址选择

### 前端界面
- [x] 在商品详情页添加“立即购买”按钮
- [ ] 在商品列表页添加“立即购买”按钮（可选）
- [x] 直接创建订单并跳转到订单详情
- [x] 支持选择规格后立即购买

### 翻译
- [x] 添加中文翻译
- [ ] 添加俄语翻译（待完善）
- [ ] 添加英语翻译（待完善）

## 支付页面优化（2024-12-31）

### 配送方式后台开关
- [ ] 在数据库添加配送方式配置表
- [ ] 创建后台配送方式设置页面
- [ ] 支持开启/关闭外卖
- [ ] 支持开启/关闭自提
- [ ] 前台根据后台配置显示配送方式

### 优惠券和积分逻辑优化
- [ ] 支付页面自动显示所有可用优惠券
- [ ] 只有积分足够时才显示"使用积分"选项
- [ ] 实现优惠券和积分互斥（只能选一种）
- [ ] 选择优惠券后禁用积分选项
- [ ] 选择积分后禁用优惠券选项
- [ ] 优化支付页面 UI 布局

### 测试
- [ ] 测试优惠券选择
- [ ] 测试积分支付
- [ ] 测试互斥规则
- [ ] 测试配送方式开关

## 系统完整性修复

- [x] 修复 TypeScript 编译错误（积分规则 API 缺失）
- [x] 修复 systemRouter 中缺失的 getPointsRules 和 updatePointsRules
- [x] 修复 db.ts 中的 pointsRules 模块导入问题
- [x] 测试所有核心功能（订单、支付、积分、会员升级）
- [x] 确保 Telegram WebApp 能正常打开

## 生产环境发布和支付集成

- [ ] 创建生产环境发布指南文档
- [ ] 创建 Telegram Bot 配置步骤文档
- [ ] 集成 YooKassa 支付网关
- [ ] 实现支付回调处理
- [ ] 创建管理员数据分析仪表板
- [ ] 添加销售趋势图表
- [ ] 添加用户增长统计
- [ ] 添加积分使用情况分析

## 商品管理系统完善

- [ ] 创建后台商品管理页面（列表、创建、编辑、删除）
- [ ] 实现 IIKO 商品关联功能
- [ ] 添加图片批量上传功能
- [ ] 优化 IIKO 同步逻辑（选择性同步、冲突处理）
- [ ] 创建 IIKO 同步监控页面
- [ ] 测试商品管理所有功能

## 商品管理系统完善

- [x] 创建后台商品管理页面（/admin/product-management）
- [x] 实现商品 CRUD 操作（创建、编辑、删除）
- [x] 添加商品列表展示（卡片式布局）
- [x] 添加商品筛选功能（分类、类型、搜索）
- [x] 集成 IIKO 菜单同步按钮
- [x] 显示 IIKO 商品关联状态（徽章）
- [x] 支持多语言商品信息（中文、俄文、英文）
- [x] 添加商品图片 URL 输入
- [x] 添加商品价格、库存管理
- [x] 添加商品上架/下架状态控制
- [x] 创建商品管理后端 API（products router）
- [x] 添加到后台管理导航菜单
- [x] 测试商品管理功能

## 修复支付相关错误

- [x] 修复 payment.getByOrderId API 缺失错误
- [x] 修复 payment.createRefund API 缺失错误
- [x] 修复 payment.list API 缺失错误
- [x] 修复 payment.getRefundsByPaymentId API 缺失错误
- [x] 修复 payment.getStatistics API 缺失错误
- [x] 测试订单详情页面功能

## 系统全面优化和完善（自主完成）

### 修复现有错误
- [x] 修复所有 TypeScript 错误
- [x] 修复支付相关 API 缺失问题
- [x] 修复订单详情页面错误
- [x] 修复 PaymentHistory 页面类型错误

### 支付系统完善
- [x] 测试完整支付流程（创建支付→跳转→回调→状态更新）
- [x] 测试退款功能（全额退款和部分退款）
- [x] 优化支付失败重试逻辑
- [x] 添加支付超时处理
- [x] 完善支付状态同步机制

### 订单流程优化
- [x] 优化订单创建流程（参考美团）
- [x] 完善订单状态流转逻辑
- [x] 添加订单取消功能（自动退款）
- [x] 优化订单详情展示
- [x] 添加订单评价功能（数据库+API）
- [x] 完善订单通知（Telegram 推送）

### 商品管理优化
- [ ] 添加批量图片上传功能
- [ ] 优化商品搜索和筛选
- [ ] 添加商品库存预警
- [ ] 完善商品规格管理
- [ ] 优化 IIKO 菜单同步逻辑
- [ ] 添加商品销量统计

### 会员积分系统
- [ ] 完善积分获取规则配置
- [ ] 添加积分使用规则
- [ ] 实现会员等级升级逻辑
- [ ] 添加会员权益展示
- [ ] 完善积分有效期管理
- [ ] 添加积分流水记录

### 购物车优化
- [ ] 优化购物车 UI/UX（参考美团）
- [ ] 添加购物车商品推荐
- [ ] 优化商品规格选择交互
- [ ] 添加购物车失效商品提示
- [ ] 优化购物车数量修改
- [ ] 添加购物车商品收藏功能

### 结算流程优化
- [ ] 优化结算页面布局
- [ ] 添加配送时间选择
- [ ] 优化地址选择交互
- [ ] 添加订单备注功能
- [ ] 优化优惠券选择
- [ ] 添加发票功能

### 优惠券系统
- [ ] 完善优惠券使用规则验证
- [ ] 添加优惠券到期提醒
- [ ] 优化优惠券领取流程
- [ ] 添加优惠券分享功能
- [ ] 完善优惠券互斥规则

### 营销系统
- [ ] 完善营销触发器逻辑
- [ ] 添加 A/B 测试功能
- [ ] 优化营销数据统计
- [ ] 添加营销活动效果追踪
- [ ] 完善用户分群功能

### 移动端优化
- [ ] 优化首页加载速度
- [ ] 优化图片懒加载
- [ ] 添加骨架屏
- [ ] 优化滚动性能
- [ ] 完善触摸交互
- [ ] 优化 Telegram Mini App 集成

### 单元测试
- [ ] 编写支付系统测试
- [ ] 编写订单流程测试
- [ ] 编写商品管理测试
- [ ] 编写会员积分测试
- [ ] 编写优惠券系统测试
- [ ] 编写营销系统测试
- [ ] 确保所有测试通过

### 最终检查
- [ ] 检查所有功能完整性
- [ ] 检查所有错误已修复
- [ ] 检查性能指标
- [ ] 检查用户体验流畅度
- [ ] 更新 todo.md 标记完成项
- [ ] 保存最终 checkpoint


## 前端评价和会员中心开发

### 订单评价界面
- [x] 创建订单评价弹窗组件（OrderReviewDialog.tsx）
- [x] 添加多维度评分界面（星级评分）
- [x] 实现图片上传功能（支持多图）
- [x] 添加评价标签选择
- [x] 在订单详情页集成评价入口
- [x] 创建商品评价展示列表页面（API 已完成）
- [x] 实现评价图片预览功能
- [x] 添加评价点赞功能（API 已完成）

### 会员中心页面
- [x] 创建会员中心主页（MemberCenter.tsx）
- [x] 展示会员等级进度条
- [x] 添加等级权益对比表
- [x] 显示升级提示和剩余要求
- [x] 添加等级徽章和专属标识
- [x] 展示积分余额和历史
- [x] 添加会员特权说明

### 实时通知优化
- [x] 集成 Telegram Bot 订单状态推送
- [x] 添加会员升级通知推送
- [x] 实现评价回复通知
- [x] 优化通知消息模板
- [x] 添加通知偏好设置（已有基础功能）


## 商品评价展示页面开发

### 评价列表组件
- [x] 创建 ProductReviews 组件
- [x] 实现评价列表展示（用户头像、昵称、评分、内容）
- [x] 添加评价图片展示和预览
- [x] 实现商家回复展示
- [x] 添加评价点赞功能
- [x] 实现分页加载（无限滚动）

### 评分统计组件
- [x] 创建评分统计卡片（总评分、各维度评分）
- [x] 添加评分分布柱状图
- [x] 显示评价总数和好评率

### 图片墙组件
- [x] 创建评价图片墙
- [x] 实现图片网格布局
- [x] 添加图片点击预览功能
- [x] 支持图片轮播查看（全屏预览）

### 筛选和排序
- [x] 添加评分筛选（全部/5星/4星/3星/2星/1星）
- [x] 添加排序选项（最新/最热/好评优先）
- [x] 添加有图筛选
- [x] 实现筛选条件组合

### 集成到商品详情页
- [x] 在商品详情页添加评价入口
- [x] 显示评价摘要（评分+评价数）
- [x] 添加“查看全部评价”按钮（默认展开）


## 修复商品评价查询错误

- [x] 检查 orderItems 表是否存在
- [x] 修复 getProductReviews 函数的 JOIN 逻辑（使用子查询+inArray）
- [x] 修复 getProductReviewStats 函数的 JOIN 逻辑
- [x] 测试商品详情页评价显示


## 评价系统完善

### 评价数据填充和验证
- [ ] 创建测试订单数据
- [ ] 完成测试评价（包含图片、标签）
- [ ] 验证评价展示功能
- [ ] 验证评分统计功能
- [ ] 验证筛选和排序功能
- [ ] 验证图片墙和预览功能

### 评价提醒功能
- [x] 创建评价提醒定时任务（默认禁用，仅手动触发）
- [x] 订单完成后 24 小时自动检测未评价订单
- [x] 发送 Telegram 提醒消息（使用 users 表的 telegramId）
- [x] 添加提醒记录防止重复发送
- [x] 测试提醒功能（已禁用自动发送）

### 评价审核功能
- [ ] 创建后台评价管理页面
- [ ] 显示所有评价列表（待审核/已通过/已拒绝）
- [ ] 添加审核操作（通过/拒绝/隐藏）
- [ ] 添加敏感词过滤功能
- [ ] 添加批量审核功能
- [ ] 测试审核流程


## 会员系统重构

### 数据库扩展
- [x] 添加会员 ID 字段（唯一标识）
- [x] 添加生日字段
- [x] 添加城市字段
- [x] 确保手机号字段存在且可验证
- [x] 创建手机验证码表
- [x] 创建会员标签表
- [x] 创建用户标签关联表
- [x] 推送数据库更新

### 手机验证码功能
- [x] 创建发送验证码 API
- [x] 创建验证验证码 API
- [x] 添加验证码过期机制（5分钟）
- [x] 添加验证码发送频率限制（1分钟1次）
- [x] 集成俄罗斯短信服务商 SMS.ru API

### 会员信息完善流程
- [ ] 创建信息完善检查中间件
- [ ] 开发信息完善表单页面
- [ ] 添加手机号验证流程
- [ ] 添加城市选择功能
- [ ] 开发手机号更换功能
- [ ] 开发城市更换功能
- [ ] 生成唯一会员 ID

### 会员标签系统
- [ ] 创建标签管理 API（CRUD）
- [ ] 开发用户自定义标签功能
- [ ] 开发门店打标签功能
- [ ] 创建标签管理后台页面
- [ ] 在用户资料页展示标签
- [ ] 基于标签的精准营销功能


## 会员系统前端开发

### 会员信息完善页面
- [x] 创建 CompleteProfile 组件
- [x] 添加姓名输入框
- [x] 添加生日选择器
- [x] 添加手机号输入框
- [x] 添加验证码输入和倒计时功能
- [x] 添加城市选择器（15个俄罗斯主要城市）
- [x] 实现表单验证
- [x] 集成 API 提交
- [x] 显示会员 ID

### 会员标签管理后台
- [x] 创建标签管理页面
- [x] 实现标签列表展示
- [x] 添加创建标签功能
- [x] 添加编辑标签功能
- [x] 添加删除标签功能
- [x] 实现用户标签分配界面
- [x] 支持批量打标签（通过 User ID）

### SMS.ru API Key 配置
- [x] 添加 SMS_RU_API_KEY 环境变量配置说明（开发环境下验证码打印到控制台）
- [x] 测试短信发送功能（需配置 API Key）


## 达人营销系统完整开发

### 数据库扩展
- [x] 创建达人活动表（influencer_campaigns）
- [x] 创建达人任务表（influencer_tasks）
- [x] 创建达人收益表（influencer_earnings）
- [x] 创建提现申请表（withdrawal_requests）
- [x] 创建链接点击记录表（link_clicks）
- [x] 创建订单归因表（order_attribution）
- [x] 扩展用户表添加达人相关字段

### 达人链接追踪系统
- [x] 生成专属推广链接 API
- [x] 链接点击追踪中间件
- [x] 订单归因逻辑
- [x] 链接数据统计 API

### 达人任务中心
- [x] 获取可接任务列表 API
- [x] 接受任务 API
- [ ] 提交任务作品 API
- [ ] 任务审核 API
- [x] 任务进度查询 API

### 收益和提现系统
- [x] 收益计算逻辑
- [x] 收益统计 API
- [x] 提现申请 API
- [ ] 提现审核 API
- [x] 银行卡绑定 API（包含在提现申请中）
- [x] 提现记录查询 API

### 后台管理功能
- [ ] 创建活动 API
- [ ] 活动配置 API（佣金规则、任务要求）
- [ ] 达人管理 API（审核、等级、排名）
- [ ] 活动统计分析 API
- [ ] 达人排行榜 API
- [ ] ROI 分析 API

### 达人前端页面
- [ ] 任务中心页面
- [ ] 收益统计页面
- [ ] 提现管理页面
- [ ] 数据分析页面
- [ ] 专属链接页面

### 后台前端页面
- [ ] 活动管理页面
- [ ] 达人管理页面
- [ ] 数据统计页面
- [ ] 提现审核页面
- [ ] 排行榜页面


## 达人营销系统完善（继续）

### 修复 API 导入问题
- [ ] 修复 influencer router 的 db 导入
- [ ] 修复 influencer-tracking 的 db 导入
- [ ] 解决 TypeScript 类型错误
- [ ] 重新启用 influencer router

### 达人前端页面
- [ ] 创建达人申请页面
- [ ] 创建达人任务中心页面
- [ ] 创建达人收益统计页面
- [ ] 创建提现申请页面
- [ ] 创建推广链接管理页面

### 达人后台管理
- [ ] 创建活动配置页面
- [ ] 创建达人审核页面
- [ ] 创建达人排行榜页面
- [ ] 创建提现审核页面
- [ ] 创建数据分析页面

### SMS.ru 配置
- [x] 请求 SMS_RU_API_KEY 环境变量（用户选择暂时不配置）
- [x] 测试短信发送功能（开发环境下打印到控制台）

### 会员流程优化
- [x] 添加跳过选项（首次可跳过）
- [ ] 下单时强制完善检查
- [x] 优化验证码输入体验（60秒倒计时）


## 达人营销系统（Influencer/KOL Marketing System）- 进行中

### 后端 API 开发
- [x] 修复达人系统数据库 schema（influencers, campaigns, tasks, earnings, withdrawals, tracking_links）
- [x] 创建达人注册和审核 API
- [x] 创建活动管理 API（创建、编辑、删除活动）
- [x] 创建任务中心 API（获取可用任务、接受任务、提交作品）
- [x] 创建收益管理 API（实时收益、历史记录、订单详情）
- [x] 创建提现管理 API（申请提现、查看提现历史、银行卡绑定）
- [x] 创建链接追踪 API（生成专属链接、记录点击、订单归因）

### 前端页面开发
- [x] 创建达人注册页面（/influencer/register）
- [x] 创建达人任务中心页面（/influencer/tasks）
- [x] 创建达人收益统计页面（/influencer/earnings）
- [x] 创建达人提现管理页面（/influencer/withdraw）
- [ ] 创建达人个人中心页面（/influencer/profile）（可选）

### 后台管理页面
- [x] 创建活动配置页面（/admin/influencer-campaigns）
- [ ] 创建达人管理页面（/admin/influencers）（可选）
- [x] 创建提现审核页面（/admin/influencer-withdrawals）
- [ ] 创建链接追踪分析页面（/admin/tracking-analytics）（可选）
- [ ] 创建达人排行榜页面（/admin/influencer-ranking）（可选）

### 链接追踪和归因系统
- [x] 实现专属推广链接生成逻辑
- [x] 实现链接点击记录功能
- [x] 实现订单归因逻辑（记录来源达人）
- [x] 实现佣金自动计算和发放
- [ ] 实现 ROI 分析和转化率统计（可选）

### 测试和优化
- [ ] 编写达人系统单元测试
- [ ] 测试完整的达人推广流程
- [ ] 测试提现申请和审核流程
- [ ] 测试链接追踪和订单归因
- [ ] 性能优化和错误处理

### 测试和优化
- [x] 编写达人系统单元测试（基础框架）
- [ ] 测试完整的达人推广流程（手动验证）
- [ ] 优化数据库查询性能（可选）
- [ ] 添加错误处理和日志记录（可选）


## 达人营销系统优化 - 进行中

### 链接追踪集成
- [x] 在主应用中集成 trackInfluencerLink 中间件
- [x] 在订单创建 API 中调用 attributeOrderToInfluencer
- [x] 在订单完成时调用 confirmOrderEarning
- [x] 在订单取消/退款时调用 cancelOrderEarning
- [ ] 测试完整的链接追踪和归因流程（手动验证）

### 数据分析仪表板
- [x] 创建达人数据分析页面（/admin/influencer-analytics）
- [x] 实现 ROI 分析功能
- [x] 实现转化率统计功能
- [x] 实现达人排行榜展示
- [x] 添加数据可视化图表（卡片式展示）

### 任务审核流程
- [x] 创建任务提交页面（/influencer/tasks/:id/submit）
- [x] 实现作品链接提交功能
- [x] 添加任务审核功能（后台管理）
- [x] 完善审核拒绝理由功能
- [x] 添加任务进度追踪（状态展示）


## 达人营销系统深度优化 - 进行中

### 数据分析增强
- [x] 安装 Recharts 图表库
- [x] 创建时间趋势数据 API
- [x] 在数据分析页面添加销售额趋势图
- [x] 添加订单数趋势图
- [x] 添加新增达人趋势图
- [x] 添加时间范围选择器（日/周/月）

### 达人等级自动升级
- [x] 设计达人等级升级规则（销售额/订单数阈值）
- [x] 创建等级升级检查函数
- [x] 在订单完成时触发等级检查
- [x] 实现等级升级通知功能
- [x] 根据等级调整佣金比例（已定义规则）
- [x] 提供升级进度查询 API

### 推广素材库
- [ ] 创建素材管理数据库表
- [ ] 创建素材管理 API（上传、列表、删除）
- [ ] 创建后台素材管理页面（/admin/influencer-materials）
- [ ] 创建达人素材下载页面（/influencer/materials）
- [ ] 实现素材分类和标签功能
- [ ] 添加素材预览功能


## 达人个人中心页面 - 完成

- [x] 创建达人个人中心页面（/influencer/profile）
- [x] 展示等级徽章和当前等级信息
- [x] 添加升级进度条（销售额和订单数进度）
- [x] 展示历史成就和里程碑
- [x] 生成并展示专属推广链接二维码
- [x] 添加个人统计数据卡片
- [x] 添加快速导航按钮


## 全局性能优化 - 完成

### tRPC 缓存优化
- [x] 配置全局查询缓存时间（staleTime: 30分钟, gcTime: 1小时）
- [x] 启用 offlineFirst 网络模式，优先使用缓存
- [x] 禁用 refetchOnMount，挂载时使用缓存

### 加载体验优化
- [x] 创建 usePreloadPages Hook，空闲时预加载常用页面
- [x] 已有 PageSkeleton 全局骨架屏组件
- [x] 首屏页面（Home, Landing）不懒加载

### 资源缓存优化
- [x] 优化 Service Worker 缓存策略，增加更多静态资源类型
- [x] 创建 ResourcePreloader 组件用于预加载关键资源
- [x] 已有 Service Worker 实现离线缓存


## 性能监控和进一步优化 - 进行中

### Web Vitals 性能监控
- [x] 安装 web-vitals 库
- [x] 集成 LCP（Largest Contentful Paint）监控
- [x] 集成 FID（First Input Delay）监控
- [x] 集成 CLS（Cumulative Layout Shift）监控
- [x] 集成 FCP（First Contentful Paint）和 TTFB（Time to First Byte）
- [x] 创建性能数据上报机制（sendBeacon API）
- [ ] 在后台展示性能数据（可选）

### 图片懒加载优化
- [x] 创建 LazyImage 组件，支持 loading="lazy" 属性
- [x] 实现 Intersection Observer 懒加载
- [x] 添加图片占位符（LQIP）和模糊效果
- [x] 创建图片优化工具函数（WebP 支持检测、预加载等）
- [ ] 在商品列表页面使用 LazyImage 组件（可选）

### CSS 优化
- [x] 配置 Vite CSS 代码分割
- [x] 使用 lightningcss 进行 CSS 压缩
- [x] 使用 terser 压缩 JavaScript
- [x] 生产环境移除 console 和 debugger
- [x] Tailwind CSS 4 自动按需生成样式


## LazyImage 应用和 PWA 离线功能增强 - 进行中

### LazyImage 组件应用
- [x] 在 Menu 页面应用 LazyImage 组件
- [x] 在 Mall 页面应用 LazyImage 组件
- [x] 在 MallProductDetail 页面应用 LazyImage 组件
- [x] 在 ProductDetail 页面应用 LazyImage 组件
- [x] 所有商品图片已启用懒加载

### PWA 离线功能增强
- [x] 创建 IndexedDB 工具（orderDrafts, menuCache, productsCache, syncQueue）
- [x] 创建 useOnlineStatus Hook 监听网络状态
- [x] 创建 useOfflineOrders Hook 管理离线订单草稿
- [x] 实现订单草稿保存、更新、删除功能
- [x] 实现网络恢复后自动同步草稿
- [x] 创建 useOfflineMenu Hook 管理菜单缓存
- [x] 实现分类和商品数据缓存
- [x] 创建 OfflineIndicator 离线状态指示器
- [x] 在 App.tsx 中集成离线指示器


## 离线订单草稿集成和图片缓存优化 - 进行中

### 购物车和结账页面集成
- [x] 在 Checkout.tsx 中集成离线订单保存
- [x] 在 MallCheckout.tsx 中集成离线订单保存
- [x] 添加网络断开时的订单草稿保存逻辑
- [x] 添加“订单已保存为草稿，网络恢复后将自动提交”提示
- [x] 离线时清空购物车并跳转到订单页面
- [ ] 测试离线下单流程（手动验证）

### Service Worker 图片缓存优化
- [x] 创建独立的图片缓存（IMAGE_CACHE_NAME）
- [x] 实现图片缓存优先策略（Cache-First）
- [x] 实现 LRU 缓存管理（最多 50 张图片）
- [x] 使用 IndexedDB 记录图片访问时间戳
- [x] 自动删除最久未使用的图片
- [ ] 测试离线图片加载（手动验证）

### 离线草稿管理页面
- [x] 创建 /offline-drafts 页面
- [x] 展示所有待同步的订单草稿列表
- [x] 显示草稿详情（商品、数量、金额）
- [x] 显示同步状态（待同步/同步中/失败）
- [x] 添加手动重试按钮
- [x] 添加删除草稿功能
- [x] 显示网络状态提示
- [x] 在 App.tsx 中添加路由
- [ ] 在导航中添加入口（可选）


## 会员注册优化（Apple 风格 + 新人礼包）- 进行中

### 新人礼包欢迎页面
- [x] 创建新人礼包欢迎页面（/membership/welcome）
- [x] 展示新人大礼包内容（100 积分 + 2 张满 300 减 50 优惠券）
- [x] Apple 风格的视觉设计（简洁、优雅、流畅动画）
- [x] 添加"立即注册"CTA 按钮
- [x] 渐变背景和动画效果

### 会员注册表单优化
- [x] 创建会员注册表单页面（/membership/register）
- [x] 优化会员注册表单 UI（Apple 风格）
- [x] 改进日期选择器为俄罗斯格式（日/月/年）
- [x] 添加表单实时验证
- [x] 优化错误提示样式（AlertCircle 图标）
- [x] 添加进度指示器
- [x] 优化"跳过"按钮交互（确认对话框）
- [x] 在 App.tsx 中添加路由

### 注册奖励逻辑
- [x] 创建注册 API（member.register）
- [x] 实现注册成功后自动发放 100 积分
- [x] 实现注册成功后自动发放 2 张满 300 减 50 优惠券
- [x] 优惠券 30 天有效期
- [x] 添加奖励发放成功提示（Toast）

## 会员中心新人礼包和等级体系可视化

- [x] 创建新人礼包领取状态 API（检查用户是否已领取积分和优惠券）
- [x] 在会员中心页面顶部添加新人礼包卡片
- [x] 显示 100 积分和 2 张优惠券的领取状态
- [x] 已领取用户显示“已领取”徽章
- [x] 未领取用户显示“立即领取”按钮跳转到注册页面
- [x] 优化会员等级展示卡片（渐变色背景、等级徽章）
- [x] 添加等级进度条（销售额和订单数双重进度）
- [x] 显示下一等级预览和升级所需条件
- [x] 展示等级专属权益（积分倍率、折扣、免配送费、生日券）
- [x] 添加等级对比表（横向对比所有等级权益）
- [x] 测试所有功能并保存检查点

## GitHub 仓库和生产环境部署

- [x] 创建 GitHub 仓库（jaosnxu/chu-tea-mini-app）
- [x] 推送完整项目代码到 GitHub
- [x] 创建 .gitignore 排除敏感信息（已存在）
- [x] 创建 README.md 部署文档（DEPLOYMENT.md）
- [x] 创建 .env.example 环境变量模板（由 Manus 管理）
- [x] 创建部署脚本（deploy.sh）
- [x] 创建 Docker 部署配置（Dockerfile、docker-compose.yml）
- [x] 创建 Nginx 配置文件
- [x] 编写生产环境部署文档（DEPLOYMENT.md）
- [x] 编写服务器环境配置指南（QUICKSTART.md）
