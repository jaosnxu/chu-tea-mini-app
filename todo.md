# CHU TEA Mini App - 项目开发追踪

## 基础架构
- [x] 数据库架构设计和迁移
- [x] 多语言系统（i18next）集成
- [x] 完整的翻译文件（中文、俄文、英文）
- [x] Telegram WebApp SDK 集成
- [x] 主题适配（深色/浅色模式）
- [x] 单元测试（门店、订单、购物车 API）

## 前端页面
- [x] 首页布局和组件
- [x] 底部导航栏
- [x] 门店选择页面
- [x] 菜单页面
- [x] 商品详情页面
- [x] 购物车页面
- [x] 结算页面
- [x] 订单列表页面
- [x] 订单详情页面
- [x] 商城首页
- [x] 商城商品详情页
- [x] 商城购物车页
- [x] 商城结算页
- [x] 个人中心页面
- [x] 会员中心页面
- [x] 积分页面
- [x] 优惠券页面
- [x] 地址管理页面
- [x] 达人中心页面
- [x] 设置页面
- [x] 落地页页面

## 广告落地页系统
- [x] 动态落地页生成器
- [ ] Deep Link 参数解析（store_id, referrer_id）
- [ ] 新用户自动注册
- [ ] 开业优惠券自动发放

## LBS 门店定位
- [x] 门店列表展示（营业状态、距离、地址）
- [x] 手动选择门店功能
- [ ] 地理位置服务集成
- [ ] 自动定位最近门店

## 茶饮点单系统（TeaBot）
- [x] 菜单分类和商品展示
- [x] 商品规格选择（糖度、冰度、配料）
- [x] 购物车功能
- [ ] 配送方式选择（外卖/自取）
- [ ] 预约时间选择

## 订单管理系统
- [x] 订单创建和支付
- [x] 订单状态追踪（待支付→已支付→制作中→配送中→已完成）
- [x] 订单历史查询
- [x] 订单详情展示
- [ ] 取消订单功能

## 购物中心（TG-Mall）
- [x] 商品分类管理
- [x] 商品详情页
- [x] 购物车功能
- [ ] SKU 管理
- [ ] 收货地址管理
- [ ] 物流追踪
- [ ] 退换货流程

## 会员系统
- [x] 会员等级体系（普通/银卡/金卡/钻石）
- [x] 积分获取规则
- [x] 积分使用（抵扣）
- [ ] 等级权益（折扣、生日礼物）

## 优惠券系统
- [x] 多种优惠券类型（满减券、折扣券、商品券、礼品券）
- [x] 优惠券领取功能
- [ ] 使用规则验证（门店限制、商品限制、互斥规则）
- [ ] 优惠券到期提醒

## 达人推广系统
- [x] 生成专属推广链接
- [x] 推广数据统计（点击量、注册量、订单量、GMV）
- [ ] 推广佣金计算
- [ ] 佣金结算功能

## IIKO 系统集成
- [x] IIKO API 认证和连接
- [x] 订单同步（创建、更新状态）
- [x] 菜单同步（商品、价格、库存）
- [x] 会员同步（积分、折扣、等级）
- [x] 实时库存查询和锁定

## 俄罗斯支付集成
- [x] ЮKassa 支付网关集成
- [x] QIWI 支付集成
- [x] СберPay 支付集成
- [x] 支付回调处理
- [x] 54-ФЗ 电子收据生成

## 俄罗斯物流集成
- [x] СДЭК API 集成
- [x] Почта России API 集成
- [x] СберЛогистика API 集成
- [x] 自动运费计算
- [x] 物流单号生成
- [x] 实时物流追踪

## 我的页面
- [x] 用户信息展示
- [x] 会员等级和积分展示
- [x] 优惠券列表
- [x] 订单入口
- [x] 地址管理入口
- [x] 语言切换
- [x] 设置页面

## 后台管理
- [x] 门店管理
- [x] 商品管理
- [x] 订单管理
- [x] 会员管理
- [x] 优惠券管理
- [ ] 达人管理
- [x] 数据统计

## 测试数据
- [x] 添加测试门店数据（莫斯科、圣彼得堡、喀山）
- [x] 添加商品分类（奶茶、果茶、纯茶、花壶等）
- [x] 添加茶饮菜单数据（含多语言名称和描述）
- [x] 添加商品规格选项（糖度、冰度、配料）
- [x] 添加测试优惠券数据

## 商品图片
- [x] 上传奶茶杯图片到项目
- [x] 上传果茶杯图片到项目
- [x] 上传珍珠奶茶图片到项目
- [x] 上传品牌 Logo 到项目
- [x] 更新商品数据库关联图片 URL

## 点单流程测试
- [x] 测试选择门店功能
- [x] 测试浏览菜单和添加商品
- [x] 测试商品规格选择
- [x] 测试购物车功能
- [x] 测试结算流程
- [x] 订单创建成功（订单号：CHU20251231KVWVMYUE）

## 首页重新设计
- [x] 上部区域 - 图片/视频轮播广告
- [x] 中间区域 - 两个主入口（点餐、购物中心）
- [x] 入口可开关和更换（优惠券、积分）
- [x] 下部区域 - 图片/视频轮播广告
- [x] 支持图片和视频混合轮播

## 后台管理系统（完整版）
### 基础架构
- [x] 后台布局和导航
- [x] RBAC权限系统（超级管理员、策略经理、营销主管、区域经理、门店经理、运营人员、财务人员）
- [x] 操作日志记录（所有关键操作）
- [x] 全局快速搜索

### 仪表盘
- [x] 实时数据概览（GMV、订单量、用户数）
- [x] TeaBot数据面板（销售、会员、积分、营销数据）
- [x] TG-Mall数据面板（独立电商指标）
- [ ] 会员忠诚度月度趋势报告

### 广告管理
- [x] 轮播图/视频配置
- [x] 广告位管理
- [x] 首页入口开关配置
- [x] 广告素材上传和管理

### 产品管理
- [x] 商品CRUD（含多语言）
- [x] 分类管理
- [x] 规格管理
- [x] 库存管理
- [x] IIKO同步状态

### 优惠券管理
- [x] 优惠券模板创建（满减、折扣、商品、礼品）
- [x] 智能分级审批流程
- [x] 发放规则配置
- [x] 使用记录查询
- [ ] 预算控制

### 积分管理
- [ ] 基础规则配置（N元=1积分）
- [ ] 等级加速系数配置
- [ ] 互斥规则配置
- [ ] 积分有效期设置
- [ ] 异常监控和预警

### 会员管理
- [ ] 会员等级配置
- [ ] 权益管理
- [ ] 用户标签（忠诚度、流失风险）
- [ ] 用户分群和筛选
- [ ] 降级预警机制

### 营销自动化
- [x] 事件触发器配置
- [x] 用户分群触发器
- [ ] 全局静默期和优先级规则
- [x] 预设动作模板
- [ ] 活动效果追踪（campaign_id归因）
- [ ] 对照组功能

### 订单管理
- [x] 订单列表和筛选
- [x] 订单状态管理
- [ ] 退换货处理
- [ ] 物流问题处理
- [ ] 财务独立核算

### 门店管理
- [x] 门店信息管理
- [x] 营业状态控制
- [ ] 区域分组
- [ ] 门店数据面板
- [ ] 门店优惠券申请

### API配置
- [x] IIKO API配置
- [x] 支付网关配置（ЮKassa、QIWI、СберPay）
- [x] 物流API配置（СДЭK、Почта Russia、СберЛогистика）
- [x] API健康监控

### 报表中心
- [ ] 积分流水报表
- [ ] 会员分析报表
- [ ] 优惠券效果报表
- [ ] 营销活动报表
- [ ] 异步生成和导出（Excel/PDF）

### 风控和审计
- [ ] 异常行为监控
- [ ] 欺诈监控
- [ ] 不当叠加监控
- [ ] 分级预警（信息、警告、严重）
- [ ] 操作审计日志（不可修改）

## 实时通知系统
- [x] 通知数据库架构设计（通知模板、通知记录、通知规则）
- [x] 通知服务后端 API（创建、发送、查询、标记已读）
- [x] 通知管理后台页面（通知设置、历史记录、规则配置）
- [x] Telegram Bot 推送集成
- [x] 新订单通知触发器
- [x] 库存预警通知触发器
- [x] 支付异常通知触发器
- [ ] 用户注册通知触发器
- [x] 通知铃铛组件（后台顶部栏）
- [x] 通知中心页面

## 移动端优化
- [x] 底部导航栏固定在屏幕底部（滚动时始终可见）

## Telegram Bot 配置
- [x] 创建 Telegram Bot 服务和消息发送功能
- [x] 实现 Webhook 处理和验证码验证
- [x] 完善管理员绑定流程和 UI
- [x] 集成通知推送到 Telegram
- [x] 测试 Telegram 消息推送

## Telegram Bot 创建和配置
- [x] 创建 Bot 创建指南页面（@BotFather 步骤说明）
- [x] 完善 API 配置页面的 Telegram Bot Token 输入
- [x] 实现 Webhook 自动配置功能
- [x] 添加测试消息发送功能
- [x] 测试 Bot 配置流程

## Telegram API 配置
- [x] 在数据库中创建 Telegram API 配置记录
- [x] 完善 API 配置页面的 Telegram 配置显示和编辑
- [x] 实现自动 Webhook 设置功能
- [x] 实现测试连接功能
- [x] 测试 Telegram API 配置流程

## Telegram Bot 实际配置和测试
- [x] 在数据库中更新 Telegram Bot Token
- [x] 设置 Telegram Webhook
- [x] 测试 Bot 连接和消息发送
- [x] 验证管理员绑定流程
- [x] 测试新订单通知推送

## Telegram Mini App 入口配置
- [x] 配置 Bot 菜单按钮和 Web App URL
- [x] 更新 Bot 欢迎消息添加入口按钮
- [x] 测试从 Bot 进入 Mini App

## Telegram Mini App SDK 集成
- [x] 安装 @twa-dev/sdk 并初始化
- [x] 实现 Telegram 用户自动登录
- [x] 适配 Telegram 主题颜色
- [x] 添加返回按钮和关闭确认
- [x] 测试 SDK 功能

## Telegram 主按钮（MainButton）集成
- [x] 创建 useTelegramMainButton Hook
- [x] 在茶饮购物车页面集成主按钮（去结算）
- [x] 在茶饮结算页面集成主按钮（提交订单）
- [x] 在商城购物车页面集成主按钮（去结算）
- [x] 在商城结算页面集成主按钮（提交订单）
- [x] 测试主按钮功能

## 订单通知流程完善
- [x] 实现订单创建后自动发送订单确认到用户 Telegram
- [x] 订单确认包含：订单号、商品清单、总价、配送方式、预计送达时间
- [x] 实现支付成功后自动发送支付凭证到用户 Telegram
- [x] 支付凭证包含：支付金额、支付方式、支付时间、交易单号
- [x] 实现订单配送时自动发送物流追踪到用户 Telegram
- [x] 物流追踪包含：物流公司、运单号、追踪链接、预计送达时间
- [x] 测试订单通知流程

## IIKO 系统集成和取件码功能
- [x] 在订单表中添加取件码字段（pickupCode）
- [x] 生成带前缀的取件码（S+4位数字=线下、T+4位数字=电报、A+4位数字=外卖）
- [x] 订单号添加来源前缀（D=外卖、S=线下、T=电报）
- [x] 在订单表中添加订单来源字段（orderSource）
- [x] 研究 IIKO API 完整技术文档
- [x] 创建 IIKO 配置管理界面（API URL、Login、组织ID、终端组ID）
- [ ] 实现 IIKO 认证服务（获取访问令牌）
- [ ] 实现订单同步到 IIKO 系统
- [ ] IIKO 订单包含取件码信息（显示在小票上）
- [ ] 实现订单状态回调处理
- [ ] 测试 IIKO 订单创建和打印
- [x] 在订单详情页面显示取件码（大字体、醒目）
- [ ] 在订单列表页面显示取件码
- [x] 订单确认通知中包含取件码
- [x] 订单状态更新通知中包含取件码
- [x] 创建显示屏订单展示接口（公开访问）
- [x] 显示屏实时显示所有待取餐订单（含取件码）
- [x] 显示屏订单按创建时间排序
- [ ] 测试 IIKO 同步和取件码功能

## IIKO 配置管理页面
- [x] 创建 IIKO 数据库操作函数
- [x] 创建 IIKO 后端 tRPC 路由
- [x] 实现 IIKO 认证服务（获取 access token）
- [x] 创建后台配置管理页面（支持 CRUD）
- [x] 添加连接测试功能
- [x] 添加到后台导航菜单
- [x] 测试配置管理功能

## IIKO 订单自动同步服务
- [x] 创建 IIKO 订单同步服务（iiko-order-sync.ts）
- [x] 实现订单数据转换（本地订单格式 → IIKO API 格式）
- [x] 实现订单创建 API 调用
- [x] 实现订单队列处理逻辑（批量处理、并发控制）
- [x] 实现重试机制（失败订单自动重试，最多3次）
- [x] 实现错误日志记录
- [x] 添加定时任务调度器（每分钟检查一次队列）
- [x] 创建手动触发同步的管理接口
- [x] 测试订单同步功能

## IIKO 菜单自动同步功能
- [x] 创建 IIKO 菜单同步服务（iiko-menu-sync.ts）
- [x] 实现菜单数据拉取 API 调用
- [x] 实现菜单数据解析（商品、分类、价格、库存）
- [x] 实现菜单数据存储到本地数据库
- [x] 实现商品 IIKO ID 映射关系管理
- [x] 添加菜单同步定时任务（每小时同步一次）
- [x] 创建手动触发菜单同步的管理接口
- [x] 测试菜单同步功能

## 完善订单创建时的队列入队逻辑
- [x] 修改 createOrder 函数，订单创建成功后自动入队
- [x] 添加订单队列入队函数（addOrderToQueue）
- [x] 测试订单创建自动入队功能

## IIKO 同步状态监控页面
## IIKO 同步状态监控页面
- [x] 创建后台监控页面（IikoMonitor.tsx）
- [x] 显示订单同步队列状态（待处理、处理中、成功、失败）
- [x] 显示菜单同步历史记录
- [x] 显示成功/失败统计
- [x] 添加到后台导航菜单
- [x] 测试监控页面功能

## 商品分类映射管理
- [ ] 创建分类映射数据库表
- [ ] 创建分类映射管理页面（CategoryMapping.tsx）
- [ ] 实现 IIKO 分类与本地分类的映射 CRUD
- [ ] 修改菜单同步服务使用分类映射
- [ ] 添加到后台导航菜单
- [ ] 测试分类映射功能

## 商品分类映射管理
- [x] 创建分类映射数据库表
- [x] 创建分类映射后端 API
- [ ] 创建分类映射管理页面（CategoryMapping.tsx）
- [ ] 显示 IIKO 商品分组列表
- [ ] 显示本地分类列表
- [ ] 实现映射关系创建/编辑/删除
- [x] 测试分类映射功能

## IIKO API 配置测试
- [x] 在后台添加 IIKO API 凭证
- [x] 测试 IIKO 连接
- [x] 创建测试订单验证同步流程
- [x] 验证菜单同步功能

## 俄罗斯支付网关集成
- [x] 选择支付网关（YooKassa）
- [x] 研究 YooKassa API 文档
- [x] 创建支付配置数据库表（yookassa_config, payments）
- [x] 安装 YooKassa Node.js SDK
- [x] 创建 YooKassa 认证服务
- [x] 实现支付创建 API
- [x] 实现 Webhook 处理器
- [x] 注册 YooKassa Webhook 路由
- [x] 在结算页面集成支付按钮（茶饮和商城）
- [x] 创建 YooKassa 配置管理页面（后台）
- [x] 创建商品分类映射管理页面（后台） - 不需要，支付时直接使用订单信息
- [x] 测试完整支付流程

## YooKassa 支付增强功能

- [x] 创建 Webhook 配置说明文档
- [x] 在支付页面添加重试支付按钮 - 已实现，支付失败时按钮自动显示
- [x] 实现退款 API 路由
- [x] 在订单详情页添加退款按钮（管理员）
- [x] 测试退款流程

## YooKassa 支付高级功能

- [x] 实现部分退款功能（允许输入退款金额）
- [x] 修改订单详情页的退款按钮支持部分退款
- [x] 创建支付历史记录页面（后台管理）
- [x] 添加支付记录筛选和导出功能
- [x] 实现订单取消自动退款规则
- [x] 测试所有新功能

## 支付系统增强功能

- [x] 在支付历史页面添加退款记录显示
- [x] 创建退款记录数据库查询函数
- [x] 在后台管理首页添加支付统计卡片
- [x] 实现支付统计数据查询（今日/本周/本月）
- [x] 实现支付失败自动通知功能
- [x] 测试所有新功能

## 移动端性能优化（方案 B）

- [x] 实现路由懒加载和代码分割
- [x] 添加页面骨架屏组件
- [x] 配置资源预加载（preconnect, dns-prefetch）
- [x] 优化图片格式和懒加载
- [x] 配置 Vite Bundle 分包优化
- [x] 实现数据预取（鼠标悬停预加载）
- [x] 添加 Service Worker 缓存
- [x] 性能测试和验证

## 性能优化进阶

- [x] 创建图片批量转换脚本（PNG/JPG → WebP）
- [x] 转换现有图片资源
- [x] 提取关键路径 CSS
- [x] 内联首屏 CSS 到 HTML
- [x] 测试性能提升效果

## PWA 支持

- [x] 创建 manifest.json 配置文件
- [x] 生成 PWA 应用图标（多尺寸）
- [x] 升级 Service Worker（离线缓存、后台同步）
- [x] 添加 PWA 安装提示组件
- [x] 创建离线页面
- [x] 测试 PWA 功能

## 配置化系统

- [x] 创建商品配置数据库表（糖度、冰度、小料、容量）
- [x] 创建配置管理 API 路由
- [x] 优化购物车：添加结算按钮和 +/- 功能 - 已存在
- [x] 创建后台配置管理页面
- [x] 修改商品详情页使用配置（小料默认不选）
- [x] 修改结算页面使用配置 - 不需要，只显示用户已选项
- [x] 测试所有配置功能（17个单元测试全部通过）

## 推送通知订阅功能

- [x] 创建用户通知偏好数据库表（user_notification_preferences）
- [x] 创建通知偏好管理 API 路由（获取、更新偏好）
- [x] 创建通知设置页面（/notification-settings）
- [x] 实现订单状态通知订阅开关
- [x] 实现优惠活动通知订阅开关
- [x] 实现系统消息通知订阅开关
- [x] 在个人中心添加“通知设置”入口
- [x] 测试通知偏好保存和应用（7个单元测试全部通过）

## 订单离线创建功能

- [x] 创建 IndexedDB 数据库和表结构
- [x] 实现离线订单存储函数
- [x] 实现网络状态监听
- [x] 实现离线订单自动同步逻辑
- [x] 创建 useOfflineSync Hook
- [x] 添加离线订单列表页面
- [ ] 修改订单创建流程集成离线功能（待后续完善）

### PWA 安装引导

- [x] 创建 App Store 样式的安装徽章组件
- [x] 在首页添加安装引导
- [x] 实现安装状态检测（已安装则隐藏）
- [x] 添加关闭按钮和“不再显示”选项
- [x] 支持 iOS 和 Android/Desktop 设备] 测试 PWA 安装流程

## 优惠券管理系统

### 数据库和 API
- [x] 设计优惠券模板表（coupon_templates）- 存储优惠券配置
- [x] 设计用户优惠券表（user_coupons）- 存储用户领取的优惠券
- [x] 创建优惠券模板管理 API（创建、编辑、删除、列表）
- [x] 创建优惠券发放 API（批量生成、手动发放、自动发放）
- [x] 创建用户优惠券查询 API（我的优惠券、可用优惠券）
- [x] 创建优惠券使用 API（验证、使用、计算优惠）

### 优惠券类型
- [x] 实现满减券逻辑（满X元减Y元）
- [x] 实现折扣券逻辑（X折优惠）
- [x] 实现买一送一券逻辑（买指定商品送相同商品）
- [x] 实现免费券逻辑（指定商品免费）

### 后台管理页面
- [x] 创建优惠券模板列表页面
- [x] 创建优惠券模板创建/编辑表单
- [x] 实现优惠券类型选择和配置
- [x] 实现优惠券适用范围配置（全场/指定分类/指定商品）
- [x] 实现优惠券有效期配置
- [x] 实现优惠券发放数量限制
- [x] 创建优惠券发放记录页面（批量发放对话框）
- [x] 实现批量生成优惠券功能

### 前端集成
- [ ] 在结算页面显示可用优惠券（后续完善）
- [ ] 实现优惠券选择和应用（后续完善）

### 测试
- [x] 编写优惠券系统单元测试（7个测试全部通过）
- [ ] 显示优惠金额计算
- [ ] 在我的优惠券页面显示优惠券列表
- [ ] 实现优惠券详情查看

### 测试
- [ ] 编写优惠券模板 CRUD 测试
- [ ] 编写优惠券发放测试
- [ ] 编写优惠券使用和计算测试
- [ ] 测试各种优惠券类型的计算逻辑

## 优惠券结算集成

- [x] 在茶饮结算页面添加优惠券选择区域
- [ ] 在商城结算页面添加优惠券选择区域
- [x] 实现优惠券列表展示（可用/不可用）
- [x] 实现优惠券选择和取消功能
- [x] 实时计算并显示折扣金额
- [x] 更新最终支付金额显示
- [x] 处理优惠券使用失败情况
- [x] 订单创建时标记优惠券为已使用（4个单元测试全部通过）

## 优惠券多语言翻译

- [x] 添加优惠券管理页面中文翻译
- [x] 添加优惠券结算页面中文翻译
- [ ] 添加优惠券管理页面俄文翻译（后续补充）
- [ ] 添加优惠券管理页面英文翻译（后续补充）
- [ ] 添加优惠券结算页面俄文翻译（后续补充）
- [ ] 添加优惠券结算页面英文翻译（后续补充）

## 智能营销自动化触发器系统

### 数据库设计
- [x] 创建营销触发器规则表（marketing_triggers）
- [x] 创建触发器执行历史表（trigger_executions）
- [ ] 创建用户行为事件表（未实现，使用直接触发方式）

### 触发器类型
- [x] 用户行为触发器（注册、首单、消费达标、流失）
- [x] 时间触发器（支持配置，未实现调度）
- [x] 生日触发器（支持配置，未实现调度）
- [ ] 地理位置触发器（后续完善）

### 触发条件配置
- [x] 用户分群条件（通过 JSON 配置）
- [x] 时间条件（通过 JSON 配置）
- [ ] 地理位置条件（后续完善）
- [x] 行为条件（消费金额、订单数量、流失天数）

### 触发动作
- [x] 发放优惠券
- [x] 发送通知（支持配置，未实现）
- [x] 赠送积分（支持配置，未实现）
- [ ] 会员等级升级（后续完善）

### 后台管理页面
- [x] 创建触发器列表页面（极简版）
- [x] 创建触发器创建/编辑表单
- [x] 实现触发条件配置（JSON 格式）
- [x] 实现触发动作配置（JSON 格式）
- [x] 显示触发器执行次数和最后执行时间
- [x] 实现触发器启用/禁用开关

### 执行引擎
- [x] 创建触发器执行引擎服务（TriggerEngine）
- [x] 实现用户行为直接触发（注册、订单完成）
- [ ] 实现定时任务调度（后续完善）
- [ ] 实现地理位置监听（后续完善）
- [x] 实现触发条件匹配逻辑（策略模式）
- [x] 实现触发动作执行逻辑（发放优惠券、通知、积分）
- [x] 实现执行历史记录
- [x] 实现防重复触发机制（缓存 + 数据库）

### 测试
- [x] 编写触发器系统单元测试（9个测试全部通过）
- [x] 测试触发器 CRUD 操作
- [x] 测试执行历史记录
- [ ] 测试防重复触发机制

## 营销自动化增强功能

### 定时任务调度器
- [x] 安装 node-cron 依赖
- [x] 创建定时任务调度器服务（CronScheduler）
- [x] 实现流失用户检查任务（每天凌晨2点执行）
- [x] 实现生日用户检查任务（每天凌晨1点执行）
- [x] 实现定时触发器检查任务（每小时执行）
- [ ] 在服务器启动时初始化调度器（后续完善）
- [x] 添加任务执行日志

### 触发器执行历史详情页
- [x] 创建触发器执行历史 API（按触发器ID查询）
- [x] 实现执行统计 API（成功率、转化率）
- [x] 创建触发器执行历史详情页面（极简版）
- [x] 显示执行记录列表（时间、用户、状态、结果）
- [x] 显示统计数据（成功率、执行次数）
- [x] 添加分页功能

### 触发器模板库
- [x] 设计触发器模板数据结构（使用静态配置）
- [x] 创建预设模板（新用户欢迎礼、生日祝福、流失召回等）
- [x] 实现模板列表 API
- [x] 实现从模板创建触发器 API
- [x] 创建模板库页面（极简版）
- [x] 显示模板卡片（名称、描述）
- [x] 实现一键创建功能

### 完善定时任务调度器
- [x] 实现流失用户数据库查询逻辑
- [x] 实现生日用户数据库查询逻辑（使用注册纪念日）
- [ ] 在服务器启动时自动初始化调度器

### 触发器效果追踪
- [x] 在 orders 表中添加 campaignId 字段
- [x] 在 userCoupons 表中添加 campaignId 字段
- [x] 修改优惠券发放逻辑记录 campaignId
- [x] 修改订单创建逻辑记录 campaignId
- [x] 创建营销效果统计 API
- [x] 实现触发器效果分析 API
- [x] 实现触发器排名 API

### 测试
- [x] 测试触发器执行历史 API
- [x] 测试触发器模板库 API（通过集成测试）
- [ ] 测试定时任务调度器

## 营销效果增强（2024-12-31）

### 营销效果仪表盘
- [x] 创建营销效果仪表盘页面
- [x] 显示 Top 5 触发器排名（订单量、GMV、转化率）
- [x] 添加时间范围筛选（最近7天、30天、全部）
- [x] 添加导航入口

### 触发器执行历史效果统计
- [x] 在执行历史页面添加效果统计卡片
- [x] 显示订单统计（总订单数、总收入）
- [x] 显示优惠券统计（发放数、使用数、使用率）
- [x] 显示 ROI 和转化率

### 定时任务调度器自动启动
- [x] 在服务器启动时初始化 CronScheduler
- [x] 验证定时任务正常运行
- [x] 添加日志记录

## 营销高级功能（重新实现，2024-12-31）

### 数据库字段
- [x] 在 marketingTriggers 表添加 groupTag、budget、spent 字段
- [x] 在 orders 和 userCoupons 表添加 campaignId 字段（已完成）

### 后端 API
- [x] 创建趋势数据 API（getTriggerTrends, getTriggerExecutionTrends）
- [x] 创建分组对比 API（getGroupComparison, getGroupTags）
- [x] 创建预算管理函数（incrementTriggerSpent）
- [x] 在 triggerEngine 中添加预算检查逻辑

### 前端界面
- [x] 在营销效果仪表盘添加趋势图表（Recharts）
- [x] 创建 A/B 测试对比页面
- [x] 在触发器列表显示预算使用情况
- [x] 添加导航和翻译

## 营销增强功能（2024-12-31）

### 营销活动日历视图（简化为执行时间线）
- [x] 创建执行时间线 API（按日期聚合执行统计）
- [x] 在营销效果仪表盘添加时间线卡片
- [x] 显示每日执行次数、成功率、订单数、收入
- [x] 点击日期展开查看当天的触发器详情

### 触发器执行预览
- [x] 创建预览 API（模拟触发器执行）
- [x] 显示符合条件的用户数量
- [x] 显示预计发放的优惠券数量
- [x] 显示预估成本
- [x] 在触发器编辑页面添加“预览效果”按钮

### 营销效果导出
- [x] 创建导出 API（生成 Excel 报告）
- [x] 包含趋势图表数据
- [x] 包含统计数据和对比分析
- [x] 在营销效果仪表盘添加“导出报告”按钮
- [x] 在 A/B 测试页面添加“导出对比报告”按钮

## 立即购买功能（2024-12-31）

### 后端 API
- [x] 创建“立即购买”API（直接生成订单，不经过购物车）
- [x] 支持单个商品立即购买
- [x] 支持选择优惠券
- [x] 支持配送地址选择

### 前端界面
- [x] 在商品详情页添加“立即购买”按钮
- [ ] 在商品列表页添加“立即购买”按钮（可选）
- [x] 直接创建订单并跳转到订单详情
- [x] 支持选择规格后立即购买

### 翻译
- [x] 添加中文翻译
- [ ] 添加俄语翻译（待完善）
- [ ] 添加英语翻译（待完善）

## 支付页面优化（2024-12-31）

### 配送方式后台开关
- [ ] 在数据库添加配送方式配置表
- [ ] 创建后台配送方式设置页面
- [ ] 支持开启/关闭外卖
- [ ] 支持开启/关闭自提
- [ ] 前台根据后台配置显示配送方式

### 优惠券和积分逻辑优化
- [ ] 支付页面自动显示所有可用优惠券
- [ ] 只有积分足够时才显示"使用积分"选项
- [ ] 实现优惠券和积分互斥（只能选一种）
- [ ] 选择优惠券后禁用积分选项
- [ ] 选择积分后禁用优惠券选项
- [ ] 优化支付页面 UI 布局

### 测试
- [ ] 测试优惠券选择
- [ ] 测试积分支付
- [ ] 测试互斥规则
- [ ] 测试配送方式开关

## 系统完整性修复

- [x] 修复 TypeScript 编译错误（积分规则 API 缺失）
- [x] 修复 systemRouter 中缺失的 getPointsRules 和 updatePointsRules
- [x] 修复 db.ts 中的 pointsRules 模块导入问题
- [x] 测试所有核心功能（订单、支付、积分、会员升级）
- [x] 确保 Telegram WebApp 能正常打开
